<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <meta http-equiv='X-UA-Compatible' content='ie=edge'> <!--设置浏览器的兼容模式版本。表示如果在IE浏览器下则使用最新的标准，渲染当前文档-->
    <title>探秘文学之都</title>

    <!-- 这里导入 bootstrap的 css文件-->
    <!--css文件建议放在此处-->
    <!--link rel="stylesheet" href="js/bootstrap-3.4.1-dist/css/bootstrap.min.css"-->
    <link rel="stylesheet" href="js/dist5/css/bootstrap.min.css">
    <link rel="stylesheet" href="js/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="js/bootstrap-switch-dist/css/bootstrap4/bootstrap-switch.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/map.css">
    <link rel="stylesheet" href="css/question.css">

    <style>
        /*
        .mapboxgl-ctrl-group button+button {
            border-top: none
        }*/
    </style>
</head>


<body>
    <!-- 创建一个导航栏容器，使用bootstrap提供的navbar类和自定义的navbar-blur类 -->
    <nav class="navbar navbar-expand-lg navbar-light navbar-blur fixed-top">
        <!-- 创建一个导航栏折叠容器，使用bootstrap提供的collapse和navbar-collapse类 -->
        <div class="navbar-brand" href="#" id="title">探秘文学之都</span></div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <!-- 创建一个无序列表，使用bootstrap提供的navbar-nav和mx-auto类 -->
            <ul class="navbar-nav mx-auto">
                <!-- 创建五个列表项，使用bootstrap提供的nav-item类 -->
                <li class="nav-item" id="introduction"><a href="#" class="nav-link nav-link-blur">文都概览</a></li>
                <li class="nav-item active" id="people-map"><a href="#" class="nav-link nav-link-blur">文人文墨</a></li>
                <li class="nav-item" id="place-map"><a href="#" class="nav-link nav-link-blur">文风文场</a></li>
                <li class="nav-item" id="service"><a href="#" class="nav-link nav-link-blur">文旅文踪</a></li>
            </ul>
        </div>
    </nav>

    <div id='map'></div>

    <div class="map-overlay info" id="info-people">
        <button type="button" class="close close-button" aria-label="Close" id="close-button-people"><span
                aria-hidden="true">&times;</span></button>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <h4 class="place-name" id="place-name-people"></h4>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <p class="subtitle"><span class="icon"></span> 相关文人：</p>
                    <p id='people'></p>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <p class="subtitle"><span class="icon"></span> 相关文学作品：</p>
                    <p id="works"></p>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <p class="subtitle"><span class="icon"></span> 历史信息：</p>
                    <p id="information">
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="map-overlay info" id="info-place">
        <button type="button" class="close close-button" aria-label="Close" id="close-button-place"><span
                aria-hidden="true">&times;</span></button>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <h4 class="place-name" id="place-name-place"></h4>
                </div>
            </div>
            <div class="row">
                <div class="text-center card type" id="type-place" style="width: auto; margin: 0 auto;">
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <p class="subtitle"><span class="icon"></span> 地址：</p>
                    <p id='address-place'></p>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <p class="subtitle"><span class="icon"></span> 所在区：</p>
                    <p id="region-place"></p>
                </div>
            </div>
        </div>
    </div>

    <div class="map-overlay info" id="info-service">
        <hr> <!-- 这是一个分割线 -->
        <button type="button" class="close close-button" aria-label="Close" id="close-button-service"><span
                aria-hidden="true">&times;</span></button>
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <h4 class="place-name" id="place-name-service"></h4>
                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <p class="subtitle"><span class="icon"></span> 地址：</p>
                    <p id='address-service'></p>
                </div>
            </div>
            <div class="list-group d-flex justify-content-center list-group-horizontal"> <!-- 使用Bootstrap的水平列表组件 -->
                <button type="button" class="list-group-item active" aria-current="true" id="walking">步行</button>
                <!-- 使用Bootstrap的列表项样式，并添加自定义的类名和id -->
                <button type="button" class="list-group-item" id="driving">驾车</button>
                <button type="button" class="list-group-item" id="bicycling">骑行</button>
            </div>
            <div class="d-flex justify-content-center"> <!-- 使用Bootstrap的flex布局来水平居中元素 -->
                <button type="button" class="btn purple-btn" id='navigation' onclick="navigate()">前往此处</button>
                <!-- 使用Bootstrap的按钮样式，并添加自定义的类名 -->
            </div>
        </div>
    </div>

    <script>
        // 获取三个按钮元素
        var walking = document.getElementById("walking");
        var driving = document.getElementById("driving");
        var bicycling = document.getElementById("bicycling");


        // 给每个按钮添加点击事件监听器，当点击时执行相应的函数，并切换激活状态
        walking.addEventListener("click", function () {
            pathType = 'walking';
            walking.classList.add("active");
            driving.classList.remove("active");
            bicycling.classList.remove("active");
        });

        driving.addEventListener("click", function () {
            pathType = 'driving';
            driving.classList.add("active");
            walking.classList.remove("active");
            bicycling.classList.remove("active");
        });

        bicycling.addEventListener("click", function () {
            pathType = 'bicycling';
            bicycling.classList.add("active");
            walking.classList.remove("active");
            driving.classList.remove("active");
        });
    </script>


    <div class="map-overlay" id="photo">
        <img class='img-rounded' id="img">
    </div>

    <div class='legend' id="legend">
        <div class="legend-item legend-item-active" id="景点"><span class="legend-key" id="景点key"></span><span>景点</span>
        </div>
        <div class="legend-item legend-item-active" id="图书馆"><span class="legend-key"
                id="图书馆key"></span><span>图书馆</span></div>
        <div class="legend-item legend-item-active" id="书店"><span class="legend-key" id="书店key"></span><span>书店</span>
        </div>
        <div class="legend-item legend-item-active" id="博物馆"><span class="legend-key"
                id="博物馆key"></span><span>博物馆</span></div>
        <div class="legend-item legend-item-active" id="展览馆"><span class="legend-key"
                id="展览馆key"></span><span>展览馆</span></div>
        <div class="legend-item legend-item-active" id="档案馆"><span class="legend-key"
                id="档案馆key"></span><span>档案馆</span></div>
        <div class="legend-item legend-item-active" id="文化宫"><span class="legend-key"
                id="文化宫key"></span><span>文化宫</span></div>
        <div class="legend-item legend-item-active" id="出版社"><span class="legend-key"
                id="出版社key"></span><span>出版社</span></div>
        <div class="legend-item legend-item-active" id="杂志社"><span class="legend-key"
                id="杂志社key"></span><span>杂志社</span></div>
        <div class="legend-item legend-item-active" id="报社"><span class="legend-key" id="报社key"></span><span>报社</span>
        </div>
    </div>
    <div id="timeline"></div>

    <div class="container">
        <div id='showHeatmap'>
            <input name="status" type="checkbox" id="showHeatmapSwitch">
        </div>
    </div>
        <!-- <div>
            <button type="button" class="list-group-item btn-district" id="鼓楼区">占位</button>
            <button type="button" class="list-group-item btn-district" id="鼓楼区">占位</button>    
        </div>
    </div>
    <div class="btn-group">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            下拉
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <button type="button" class="list-group-item btn-district" id="鼓楼区">占位</button>
            <button type="button" class="list-group-item btn-district" id="鼓楼区">占位</button> 
        </ul>
    </div> -->    
    <div>
        <button type="button" class="list-group-item btn-district" id="鼓楼区">占位</button>
        <button type="button" class="list-group-item btn-district" id="鼓楼区">占位</button>
        <button type="button" class="list-group-item btn-district" id="鼓楼区">鼓楼区</button>
        <button type="button" class="list-group-item btn-district" id="玄武区">玄武区</button>
        <button type="button" class="list-group-item btn-district" id="秦淮区">秦淮区</button>
        <button type="button" class="list-group-item btn-district" id="建邺区">建邺区</button>
        <button type="button" class="list-group-item btn-district" id="雨花台区">雨花台区</button>
        <button type="button" class="list-group-item btn-district" id="高淳区">高淳区</button>
        <button type="button" class="list-group-item btn-district" id="江宁区">江宁区</button>
        <button type="button" class="list-group-item btn-district" id="六合区">六合区</button>
        <button type="button" class="list-group-item btn-district" id="溧水区">溧水区</button>
        <button type="button" class="list-group-item btn-district" id="浦口区">浦口区</button>
        <button type="button" class="list-group-item btn-district" id="栖霞区">栖霞区</button>

    </div>


    <div class="modal fade" id="dataModal" tabindex="-1" role="dialog" aria-labelledby="dataModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dataModalLabel">区域数据</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- 饼图容器 -->
                    <div id="pieChartContainer" style="width: 100%; height: 400px;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
    <button class="btn purple-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample"
        aria-controls="offcanvasExample" id="open" style="display: none;">
        猜你想去
    </button>

    <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel"
        data-bs-backdrop="false" style="display: none; overflow: auto;">
        <div class="offcanvas-body">
            <div class="nav nav-tabs" id="nav-tab" role="tablist" aria-disabled="true">
                <a class="nav-link active" id="question-tab" data-bs-toggle="tab" href="#question" role="tab"
                    aria-controls="nav-home" aria-selected="true">条件选择</a>
                <a class="nav-link" data-bs-toggle="tab" href="#result" role="tab" aria-controls="nav-profile"
                    aria-selected="false" id="result-tab" style="display: none">分析结果</a>
                <button type="button" class="btn-close text-reset offcanvas-btn" data-bs-dismiss="offcanvas"
                    aria-label="Close"></button>
            </div>
            <div class="tab-content">
                <div id="question" class="tab-pane fade show active"><br>
                    <div class="col-12 d-flex align-items-center title-text">我们想知道...</div>
                    <form>
                        <div class="card">
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="question1" class="form-label"><span class="icon"></span>
                                        您希望游玩的景点数量？</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question1" id="question1-1"
                                            value="1">
                                        <label class="form-check-label" for="question1-1">1个</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question1" id="question1-2"
                                            value="2">
                                        <label class="form-check-label" for="question1-2">2个</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question1" id="question1-3"
                                            value="3">
                                        <label class="form-check-label" for="question1-3">3个</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question1" id="question1-4"
                                            value="4">
                                        <label class="form-check-label" for="question1-4">4个</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="question2" class="form-label"><span class="icon"></span>
                                        您可以接受价格多高的旅游景点？</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question2" id="question2-1"
                                            value="0">
                                        <label class="form-check-label" for="question2-1">免费</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question2" id="question2-2"
                                            value="20">
                                        <label class="form-check-label" for="question2-2">20元</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question2" id="question2-3"
                                            value="50">
                                        <label class="form-check-label" for="question2-3">50元</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="question2" id="question2-4"
                                            value="100">
                                        <label class="form-check-label" for="question2-4">100元</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="question3" class="form-label"><span class="icon"></span>
                                        您希望游玩什么样的景点？</label>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-1" value="历史故事">
                                        <label class="form-check-label" for="question3-1">历史故事</label>
                                    </div>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-2" value="自然风光">
                                        <label class="form-check-label" for="question3-2">自然风光</label>
                                    </div>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-3" value="古建筑">
                                        <label class="form-check-label" for="question3-3">遗迹建筑</label>
                                    </div>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-4" value="博物展览">
                                        <label class="form-check-label" for="question3-4">博物展览</label>
                                    </div>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-4" value="文学相关">
                                        <label class="form-check-label" for="question3-4">文人相关</label>
                                    </div>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-4" value="红色文化">
                                        <label class="form-check-label" for="question3-4">红色文化</label>
                                    </div>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-4" value="热门景点">
                                        <label class="form-check-label" for="question3-4">热门景点</label>
                                    </div>
                                    <div class="form-check form-check-inline" style="margin-right: 35px;">
                                        <input class="form-check-input" type="checkbox" name="question3"
                                            id="question3-4" value="当代文创">
                                        <label class="form-check-label" for="question3-4">当代文创</label>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="mb-3 d-flex justify-content-center">
                            <button type="submit" class="btn purple-btn">生成推荐结果</button>
                        </div>
                    </form>
                </div>
                <div id="result" class="tab-pane fade"><br>
                    <div class="container-fluid">
                        <div class="list-group d-flex justify-content-center list-group-horizontal" id="list-group23D"
                            style="position:relative">
                            <!-- 使用Bootstrap的水平列表组件 -->
                            <button type="button" class="list-group-item active" aria-current="true" id="twoD"
                                onclick="show2D()">2D散点图</button>
                            <!-- 使用Bootstrap的列表项样式，并添加自定义的类名和id -->
                            <button type="button" class="list-group-item" id="threeD" onclick="show3D()">3D柱状图</button>
                        </div>
                        <div class="col-8 d-flex align-items-center title-text" style="margin-top:30px">
                            您可能想去...
                        </div>
                        <div class="card rank" id="card1">
                            <div class="circle" id="first">1</div>
                            <div class="row rank-row">
                                <div class="col-4">
                                    <img id="img-rank-1" class="img-thumbnail img-rank">
                                </div>
                                <div class="col-6 d-flex align-items-center rank-text" id="rank-text-1">
                                </div>
                                <!--div class="col-2 d-flex align-items-center rank-mark" id="mark-1">
                                    90
                                </div-->
                            </div>
                        </div>
                        <div class="card rank" id="card2">
                            <div class="circle" id="second">2</div>
                            <div class="row rank-row">
                                <div class="col-4">
                                    <img id="img-rank-2" class="img-thumbnail img-rank">
                                </div>
                                <div class="col-6 d-flex align-items-center rank-text" id="rank-text-2">
                                </div>
                                <!--div class="col-2 d-flex align-items-center rank-mark" id="mark-2">
                                    90
                                </div-->
                            </div>
                        </div>
                        <div class="card rank" id="card3">
                            <div class="circle" id="third">3</div>
                            <div class="row rank-row">
                                <div class="col-4">
                                    <img id="img-rank-3" class="img-thumbnail img-rank">
                                </div>
                                <div class="col-6 d-flex align-items-center rank-text" id="rank-text-3">
                                </div>
                                <!--div class="col-2 d-flex align-items-center rank-mark" id="mark-3">
                                    90
                                </div-->
                            </div>
                        </div>
                        <div class="col-12 d-flex align-items-center title-text" style="bottom:0px; margin-top:60px">
                            前十推荐景点的高德评分参考：
                        </div>
                        <div id="mycontainer" style="height: 450px;width:320px;position: relative;margin:0%">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="pieChartContainer" class="container-class1"></div>
    <div class="intro-overlay" id="info-intro">
        <div id='intro-img'></div>
        <div id="intro-title1">探秘</div>
        <div id="intro-title2">文学之都</div>
        <div id='intro-text'>
            <div>
                2019年，南京市被联合国授予“世界文学之都”称号，成为全球仅有的10个获此殊荣的城市之一。古往今来，金陵文化在中华文明的传承发展中独树一帜，推动着世界文学的交流与进步；在新时代文化强国背景下，古都南京日新月异，以崭新的容貌和宽广的胸怀迎接八方来客。
            </div>
            <br />
            <div>
                请跟随我们的专题系列地图，一起走进南京的佳作诗篇，从历朝历代的典故里，也在寻常人家的街头巷陌，重新认识这座车水马龙的城市。在“文人文墨”模块，我们将与您一起走过漫漫岁月长河，看千古传诵的佳句曾在古城的何处驻足；在“文风文场”模块，您将看到遍布金陵的各类文化场馆，还可以选择查看热力图，点选图中的任意场馆都能查看图文介绍；在“文旅文踪”模块，我们将根据您的选择推荐南京的文化旅游景点，还有路线等多种功能待您探索。
            </div>
            <br />
        </div>
        <button class="btn purple-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample"
            aria-controls="offcanvasExample" id="intro-btn" onclick="enter()">
            点击进入
        </button>
    </div>
    <script>
        function enter() {
            var intro = document.getElementById('info-intro')
            intro.style.animation = "shrink-fade-out 1s ease-out";
            setTimeout(function () {
                intro.style.display = "none";
            }, 1000); // 这里的时间要等于动画的持续时间
        }
    </script>

    <script>
        // 获取三个按钮元素
        var twoD = document.getElementById("twoD");
        var threeD = document.getElementById("threeD");

        twoD.addEventListener("click", function () {
            showType = 'twoD';
            twoD.classList.add("active");
            threeD.classList.remove("active")
        });

        threeD.addEventListener("click", function () {
            showType = 'threeD';
            threeD.classList.add("active");
            twoD.classList.remove("active");
        });
    </script>

    <script>
        // Get the form element
        var form = document.querySelector("form");

        cal = null;

        // Add an event listener for the submit event
        form.addEventListener("submit", function (event) {
            // Prevent the default behavior of refreshing the page
            event.preventDefault();

            // Get the form data as an array of key-value pairs
            var formData = new FormData(form);
            var data = Array.from(formData);

            var number = data[0][1];
            var price = data[1][1];
            var types = [];

            for (var i = 2; i < data.length; i++) {
                types.push(data[i][1]);
            }


            if (cal != null) {
                cal.removeAll();
                cal = null
            }
            markLayer = true
            cal = new calculation(number, price, types);
            cal.calculate();



            var twoD = document.getElementById("twoD");
            twoD.classList.add("active");
            threeD.classList.remove("active")


            document.getElementById('result-tab').style.display = 'block';
            document.getElementById('question').classList.remove("show");
            document.getElementById('question').classList.remove("active");
            document.getElementById('result').classList.add("show");
            document.getElementById('result').classList.add("active");
            document.getElementById('question-tab').classList.remove("active");
            document.getElementById('result-tab').classList.add("active");


            map.easeTo({
                // 设置目标中心点坐标
                center: [118.77266371770838, 32.03024757858705],
                // 设置目标缩放层级
                zoom: 12.5,
                // 设置目标水平倾角
                pitch: 48.8,
                // 设置目标方位角
                bearing: 0,
                // 设置过渡时间为 2 秒
                duration: 2000
            });
        });
    </script>


    <!--js文件建议放在此处-->
    <!--第三方库-->
    <script src="js/jQuery/jquery-3.6.0.min.js"></script> <!--bootstrap.min依赖于jquery,故需先导入jquery-->
    <!--script src="js/bootstrap-3.4.1-dist/js/bootstrap.min.js"></script-->
    <script src="js/dist5/js/bootstrap.min.js"></script>
    <script src="js/dist/js/bootstrap.min.js"></script>
    <script src="js/bootstrap-switch-dist/js/bootstrap-switch.js"></script>
    <script src="js/echarts.js"></script>
    <script src="js/timeline.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>

    <script src="js/map.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/heatmap.js"></script>
    <script src="js/animation.js"></script>
    <script src="js/turf.js"></script>
    <script src="js/calculation.js"></script>
    <script src="js/shining.js"></script>
    <script src="js/chart.js"></script>

    <script src="js/peopleMap.js"></script>
    <script src="js/placeMap.js"></script>
    <script src="js/serviceMap.js"></script>
</body>

<script>
    peopleMap = new peopleMap();
    placeMap = new placeMap();
    serviceMap = new serviceMap();

    // 使用querySelectorAll获取所有的链接元素，存入一个变量中
    var links = document.querySelectorAll(".nav-item");
    var myIntroductionMap = document.getElementById("introduction")
    // 遍历所有的链接元素，为每个元素添加一个点击事件的监听器
    for (var i = 0; i < links.length; i++) {
        links[i].addEventListener("click", function () {
            var current = document.querySelector(".active");
            if (this == myIntroductionMap) {
                var intro = document.getElementById('info-intro')
                intro.style.animation = "pop-out-fade-in 0.7s ease-out";
                intro.style.display = 'block'
                //if (this.getAttribute("id") == current.getAttribute("id")) return;
            } else {
                current.classList.remove("active");
                // 使用classList.add为被点击的链接元素添加active类
                this.classList.add("active");
                if (this.getAttribute("id") == current.getAttribute("id")) return;
            }

            activeMap.remove();

            switch (this.getAttribute("id")) {
                case 'introduction': break;
                case 'people-map': activeMap = peopleMap; break; //showPeopleLayer(); 
                case 'place-map': activeMap = placeMap; break;  //showPlaceLayer(); 
                case 'service': activeMap = serviceMap; break;
            }

            activeMap.create();
        });
    }
</script>

<script>
    activeMap = peopleMap;
    pathType = 'walking'
    lineLayerType = '';
    anima = null;
/*

    colorList = {
        '景点': '#0c2937',
        '图书馆': '#536070',
        '书店': '#92795a',
        '博物馆': '#c5b9ad',
        '展览馆': '#ada3a1',
        '档案馆': '#998fbe',
        '文化宫': '#bcb989',
        '出版社': '#93acbb',
        '杂志社': '#d7a183',
        '报社': '#c2ad90'
        
    };
    
    colorList = {
        '景点': '#b17d64',
        '图书馆': '#a4514f',
        '书店': '#AD6678',
        '博物馆': '#e19b69',
        '展览馆': '#fbdd85',
        '档案馆': '#ffebad',
        '文化宫': '#bfb1d0',
        '出版社': '#a7c0de',
        '杂志社': '#80a6e2',
        '报社': '#6c91c2'
        
    };
    */
    colorList = {
        '景点': '#812F33',
        '图书馆': '#a4514f',
        '书店': '#AD6678',
        '博物馆': '#C07645',
        '展览馆': '#EB761A',
        '档案馆': '#D59849',
        '文化宫': '#607A61',
        '出版社': '#52ACA5',
        '杂志社': '#2F677E',
        '报社': '#334B78'
        
    };
    

    //设置图例颜色
    for (var i in colorList) {
        var legendKey = document.getElementById(i + 'key');
        legendKey.style['background-color'] = colorList[i];
    }

    function showPeopleLayer() {
        map.setLayoutProperty('peopleLayer', 'visibility', 'visible');
        map.setLayoutProperty('peopleLabel', 'visibility', 'visible');
        map.setLayoutProperty('peopleLabel2', 'visibility', 'visible');
        map.setFilter('peopleLayer', ['==', '朝代', '六朝']);
        map.setFilter('peopleLabel', ['==', '朝代', '六朝']);
        map.setFilter('peopleLabel2', ['==', '朝代', '六朝']);
    }

    function showPlaceLayer() {
        map.setLayoutProperty('placeLayer', 'visibility', 'visible');
    }

    function showServiceLayer() {
        map.setLayoutProperty('serviceLayer', 'visibility', 'visible');
    }

    function closePeopleLayer() {
        map.setLayoutProperty('peopleLayer', 'visibility', 'none');
        map.setLayoutProperty('peopleLabel', 'visibility', 'none')
        map.setLayoutProperty('peopleLabel2', 'visibility', 'none')
    }

    function closePlaceLayer() {
        map.setLayoutProperty('placeLayer', 'visibility', 'none');
    }

    function closeServiceLayer() {
        map.setLayoutProperty('serviceLayer', 'visibility', 'none');
    }

$('#dataModal').on('shown.bs.modal', function () {
    // 获取容器
    var container = document.getElementById('pieChartContainer');
    var width = container.offsetWidth; // 使用容器的宽度
    var height = container.offsetHeight; // 使用容器的高度

    var myChart = echarts.init(container, 'light', { // 初始化图表并指定主题为'light'
    width: width + 'px',
    height: height + 'px'
    });

    // 当模态框大小变化时，重新调整图表大小
    $(window).on('resize', function () {
        myChart.resize();
    });
});

document.querySelectorAll('.btn-district').forEach(item => {
    item.addEventListener('click', function() {
        var districtId = this.id; // 获取按钮的id，即区名

        // 更新模态窗口的标题
        $('#dataModalLabel').text(districtId + ' 文化场馆统计');

        // 显示模态窗口
        $('#dataModal').modal('show');

        // 当模态窗口完全显示之后初始化或更新ECharts图表
        $('#dataModal').one('shown.bs.modal', function () {
            // 获取ECharts实例，如果没有则初始化
            var myChart = echarts.getInstanceByDom(document.getElementById('pieChartContainer')) || echarts.init(document.getElementById('pieChartContainer'));

            // 获取区域数据
            var option = getDataForDistrict(districtId);

            // 使用获取的数据更新图表
            myChart.setOption(option, true); // 第二个参数为true表示不合并，直接替换数据

            // 监听窗口大小变化事件以调整图表
            window.onresize = function() {
                myChart.resize();
            };
        });
    });
});

function getDataForDistrict(districtId) {
    var dataMap = {
        "鼓楼区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},

                data: [
                    { value: 71, name: '书店:71' },
                    { value: 12, name: '出版社:12' },
                    { value: 14, name: '图书馆:14' },
                    { value: 2, name: '展览馆:2' },
                    { value: 14, name: '报社:14' },
                    { value: 5, name: '文化宫:5' },
                    { value: 11, name: '景点:11' },
                    { value: 7, name: '杂志社:7' },
                    { value: 1, name: '档案馆:1' }  
              ]
            }]
        },
        "高淳区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                data: [
                    { value: 10, name: '书店:10' },
                    { value: 3, name: '文化宫:3' },
                    { value: 3, name: '景点:3' }
              ]
            }]
        },
        "建邺区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},
                data: [
                    { value: 21, name: '书店:21' },
                    { value: 1, name: '博物馆:1' },
                    { value: 4, name: '图书馆:4' },
                    { value: 2, name: '展览馆:2' },
                    { value: 4, name: '报社:4' },
                    { value: 5, name: '文化宫:5' },
                    { value: 3, name: '景点:3' },
                    { value: 2, name: '杂志社:2' },
                    { value: 4, name: '档案馆:4' }  
              ]
            }]
        },
        "江宁区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},
                data: [
                    { value: 68, name: '书店:68' },
                    { value: 13, name: '图书馆13:' },
                    { value: 3, name: '展览馆:3' },
                    { value: 6, name: '报社:6' },
                    { value: 5, name: '文化宫:5' },
                    { value: 4, name: '景点:4' },
                    { value: 1, name: '档案馆:1' }  
              ]
            }]
        },
        "溧水区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                label: {
                    normal: {
                    show : true,
                    position : 'outside'
                    }
                },
                data: [
                    { value: 5, name: '书店:5' },
                    { value: 5, name: '图书馆:5' },
                    { value: 2, name: '文化宫:2' },
                    { value: 2, name: '景点:2' }
              ]
            }]
        },
        "六合区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                data: [
                    { value: 10, name: '书店:10' },
                    { value: 5, name: '图书馆:5' },
                    { value: 5, name: '文化宫:5' },
                    { value: 5, name: '景点:5' }
              ]
            }]
        },
        "浦口区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},
                data: [
                    { value: 50, name: '书店:50' },
                    { value: 11, name: '图书馆:11' },
                    { value: 1, name: '展览馆:1' },
                    { value: 6, name: '文化宫:6' },
                    { value: 3, name: '景点:3' },
                    { value: 1, name: '档案馆:1' }  
              ]
            }]
        },
        "栖霞区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},
                data: [
                    { value: 34, name: '书店:34' },
                    { value: 2, name: '出版社:2' },
                    { value: 5, name: '图书馆:5' },
                    { value: 1, name: '展览馆:1' },
                    { value: 1, name: '报社:1' },
                    { value: 1, name: '文化宫:1' },
                    { value: 1, name: '档案馆:1' }  
              ]
            }]
        },
        "秦淮区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},
                data: [
                    { value: 46, name: '书店:46' },
                    { value: 3, name: '出版社:3' },
                    { value: 4, name: '博物馆:4' },
                    { value: 2, name: '图书馆:2' },
                    { value: 5, name: '展览馆:5' },
                    { value: 5, name: '报社:5' },
                    { value: 4, name: '文化宫:4' },
                    { value: 23, name: '景点:23' },
                    { value: 1, name: '杂志社:1' },
                    { value: 1, name: '档案馆:1' }  
              ]
            }]
        },
        "玄武区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},
                data: [
                    { value: 35, name: '书店:35' },
                    { value: 8, name: '出版社:8' },
                    { value: 4, name: '博物馆:4' },
                    { value: 10, name: '图书馆:10' },
                    { value: 2, name: '展览馆:2' },
                    { value: 8, name: '报社:8' },
                    { value: 3, name: '文化宫:3' },
                    { value: 22, name: '景点:22' },
                    { value: 4, name: '杂志社:4' },
                    { value: 2, name: '档案馆:2' }  
              ]
            }]
        },
        "雨花台区": {
            series: [{
                name: 'Nightingale Chart',
                type: 'pie',
                radius: [70, 180],
                center: ['50%', '50%'],
                roseType: 'area',
                itemStyle: {
                    borderRadius: 8
                },
                labelLine: {
                    normal: {
                    show:true,
                    length: 2,
                    length2: 10,
                    }},
                data: [
                    { value: 18, name: '书店:18' },
                    { value: 3, name: '图书馆:3' },
                    { value: 1, name: '报社:1' },
                    { value: 3, name: '文化宫:3' },
                    { value: 2, name: '景点:2' },
                    { value: 1, name: '档案馆:1' }  
              ]
            }]
        },




        // 添加更多区的数据...
    };

    return dataMap[districtId] || {}; // 如果找不到对应区的数据，则返回空对象
}
</script>

</html>